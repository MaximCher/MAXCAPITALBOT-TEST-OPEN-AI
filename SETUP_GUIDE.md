# Руководство по настройке MAXCAPITAL Bot

## Быстрый старт

### 1. Настройка Google Drive

#### Создание структуры папок:

1. Создайте корневую папку "MAXCAPITAL Bot Knowledge Base" в Google Drive
2. Внутри создайте две папки:
   - **Materials** - для документов, которые отправляются клиентам
   - **Info** - для информации для общения с клиентами

#### Получение ID папок:

1. Откройте папку в Google Drive
2. Скопируйте ID из URL: `https://drive.google.com/drive/folders/FOLDER_ID_HERE`
3. Добавьте в `.env`:
   ```
   DRIVE_MATERIALS_FOLDER_ID=ваш_id_папки_materials
   DRIVE_INFO_FOLDER_ID=ваш_id_папки_info
   ```

#### Настройка доступа:

1. Service Account должен иметь доступ к папкам
2. Поделитесь папками с email service account'а (можно найти в credentials.json)

### 2. Настройка Bitrix24

#### Получение ID менеджеров:

1. Войдите в Bitrix24
2. Перейдите в Настройки → Пользователи
3. Найдите нужного менеджера и скопируйте его ID
4. Добавьте в `.env`:
   ```
   B24_DEFAULT_MANAGER_ID=123
   ```

#### Назначение менеджеров по intent (опционально):

```
B24_MANAGER_INVEST=123    # Менеджер для инвестиций
B24_MANAGER_DOCUMENTS=456 # Менеджер для документов
B24_MANAGER_CONSULT=789   # Менеджер для консультаций
B24_MANAGER_SUPPORT=101   # Менеджер для поддержки
```

### 3. Заполнение базы знаний

#### Папка Materials:

Разместите файлы с понятными названиями:
- `Инвестиции_Продукт1_Презентация.pdf`
- `Документы_Договор_Шаблон.pdf`
- `Проекты_Обзор_2025.pdf`

**Рекомендации:**
- Используйте ключевые слова в названиях файлов
- Группируйте по подпапкам (Investments, Documents, Projects)
- Обновляйте материалы регулярно

#### Папка Info:

Разместите информационные файлы:
- `FAQ.md` - часто задаваемые вопросы
- `Product_Descriptions.md` - описания продуктов
- `Bot_Scripts.md` - скрипты для бота

### 4. Проверка работы

#### Тест статистики:

```bash
curl http://localhost:8000/statistics
```

#### Тест через Telegram:

1. Найдите бота в Telegram
2. Отправьте `/start`
3. Напишите: "Хочу инвестировать 10000"
4. Проверьте, что:
   - Создался контакт в Bitrix24
   - Создался лид с назначенным менеджером
   - Найдены материалы в Google Drive
   - Статистика обновилась

## Мониторинг

### Просмотр статистики:

**В браузере или через curl:**
```
GET http://localhost:8000/statistics
```

**Ответ:**
```json
{
  "total_sessions": 150,
  "total_leads": 45,
  "conversion_rate": 30.0,
  "intent_distribution": {
    "invest": 60,
    "documents": 40
  }
}
```

### Просмотр в Bitrix24:

1. Откройте CRM → Лиды
2. Фильтр: Источник = "MAXCAPITAL Telegram Bot"
3. Группировка по ответственному менеджеру
4. Анализ конверсии в сделки

### Логи:

- `bot_events.log` - все события бота
- `bot_statistics.json` - статистика в JSON формате

## Рекомендации

1. **Регулярно обновляйте материалы** в Google Drive
2. **Мониторьте конверсию** - сколько пользователей становятся лидами
3. **Анализируйте intent distribution** - какие запросы популярнее
4. **Настраивайте менеджеров** в зависимости от нагрузки
5. **Проверяйте качество материалов** - они должны быть актуальными

## Устранение проблем

### Бот не находит материалы:

1. Проверьте `DRIVE_MATERIALS_FOLDER_ID` в `.env`
2. Убедитесь, что service account имеет доступ к папке
3. Проверьте названия файлов - должны содержать ключевые слова

### Лиды не назначаются менеджерам:

1. Проверьте `B24_DEFAULT_MANAGER_ID` в `.env`
2. Убедитесь, что ID менеджера правильный в Bitrix24
3. Проверьте права доступа webhook'а

### Статистика не обновляется:

1. Проверьте права на запись в файл `bot_statistics.json`
2. Проверьте логи на ошибки
3. Убедитесь, что модуль `statistics` импортирован


# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## üîß **–ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥–∞ –≤ Bitrix24**

### –ß—Ç–æ –±—ã–ª–æ:
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL webhook (–±–µ–∑ –º–µ—Ç–æ–¥–∞)
- URL: `https://b24-qtrjoh.bitrix24.kz/rest/1/d1akkwa51l675d3h/`

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `crm.lead.add` –≤ URL
- URL: `https://b24-qtrjoh.bitrix24.kz/rest/1/d1akkwa51l675d3h/crm.lead.add`

### –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram: `@Glampingpvlbot`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é —É—Å–ª—É–≥—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Real Estate")
4. –í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã: `–¢–µ—Å—Ç–æ–≤ –¢–µ—Å—Ç +1234567890`
5. ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã" (–±–µ–∑ –æ—à–∏–±–∫–∏)
6. ‚úÖ –õ–∏–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è –≤ Bitrix24
7. ‚úÖ –í—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

---

## üîß **–ü—Ä–æ–±–ª–µ–º–∞ 2: RAG –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã**

### –ß—Ç–æ –±—ã–ª–æ:
- ‚ùå –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ similarity (0.7)
- ‚ùå AI –Ω–µ –∞–∫—Ü–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚ùå –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è DEBUG (–Ω–µ –≤–∏–¥–Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –°–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ –¥–æ 0.3 (–±–æ–ª—å—à–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —è–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç: "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –±–∞–∑–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ INFO —É—Ä–æ–≤–µ–Ω—å
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `has_context` –≤ –ª–æ–≥–∏

### –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

#### –¢–µ—Å—Ç 1: –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞: @Glampingpvlbot
2. /start
3. –í—ã–±–µ—Ä–∏—Ç–µ "Real Estate"
4. –í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
5. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ú–æ—Å–∫–≤–µ?"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ "–í—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ú–æ—Å–∫–≤—ã.pdf"

#### –¢–µ—Å—Ç 2: –ö–∞—Ä—Ç—ã
```
1. –í—ã–±–µ—Ä–∏—Ç–µ "–ó–∞—Ä—É–±–µ–∂–Ω—ã–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã"
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
3. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø—Ä–æ –∫–∞—Ä—Ç—ã –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ "–ö–∞—Ä—Ç—ã –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —ç–º–∏—Ç–µ–Ω—Ç–∞ (–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω)"

#### –¢–µ—Å—Ç 3: –†–µ–ª–æ–∫–∞—Ü–∏—è
```
1. –í—ã–±–µ—Ä–∏—Ç–µ "Relocation Support"
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
3. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑–∏–¥–µ–Ω—Å—Ç–≤–æ?"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ "–†–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è"

---

## üìä **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ RAG:**

```powershell
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f bot

# –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
# "rag_context_retrieved" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
# "has_context": true - –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞–π–¥–µ–Ω
# "context_length": > 0 - —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º RAG:**
```json
{
  "event": "rag_context_retrieved",
  "user_id": 123456,
  "context_length": 1234,
  "has_context": true
}
```

---

## üß™ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –±–∞–∑–µ:
```powershell
docker-compose exec bot python scripts/load_documents.py list
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** 8 documents

### –¢–µ—Å—Ç –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:
```powershell
docker-compose exec bot python -c "
import asyncio
from src.database import init_db, close_db, get_session
from src.vector_store import VectorStore

async def test():
    await init_db()
    async for session in get_session():
        vs = VectorStore(session)
        results = await vs.search('–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', limit=3, similarity_threshold=0.3)
        print(f'–ù–∞–π–¥–µ–Ω–æ: {len(results)} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤')
        for doc, score in results:
            print(f'  - {doc.filename} (similarity: {score:.2f})')
    await close_db()

asyncio.run(test())
"
```

**–î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏:** 2-3 –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø—Ä–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å

---

## ‚úÖ **–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:**

### Bitrix24:
- [ ] –õ–∏–¥ —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–µ–∑ –æ—à–∏–±–∫–∏
- [ ] –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã"
- [ ] –õ–∏–¥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ Bitrix24 CRM
- [ ] –ü—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É

### RAG:
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∫–∞—Ä—Ç–∞—Ö
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Ä–µ–ª–æ–∫–∞—Ü–∏–∏
- [ ] –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ `has_context: true`
- [ ] –û—Ç–≤–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

## üîç **–ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–∏–¥ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å webhook URL –≤ Bitrix24
2. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ webhook (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å CRM write)
3. –õ–æ–≥–∏: `docker-compose logs bot | grep bitrix`

### –ü—Ä–æ–±–ª–µ–º–∞: RAG –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 8
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–æ–º–∞–Ω–¥–∞ –≤—ã—à–µ)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `context_length` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0

### –ü—Ä–æ–±–ª–µ–º–∞: AI –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –í –ª–æ–≥–∞—Ö `has_context: true`
2. `context_length` > 100
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `docker-compose restart bot`

---

## üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs --tail=100 bot > logs.txt`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 2025-11-23  
**–í–µ—Ä—Å–∏—è:** 1.0.1


